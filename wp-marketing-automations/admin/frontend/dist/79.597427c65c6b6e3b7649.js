(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{1255:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a(5),c=a(1),o=a(3),i=a(9),s=a.n(i),l=a(1094),m=a(1101),b=a(36),u=a.n(b),p=a(2),d=a(1122),f=a(207),w=a(68),O=a(7),j=a(54),v=a(77),g=a(348),y=a(11),E=a(40),h=a(41);function _(){var e,t,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",n=a.toStringTag||"@@toStringTag";function c(a,r,n,c){var s=r&&r.prototype instanceof i?r:i,l=Object.create(s.prototype);return N(l,"_invoke",function(a,r,n){var c,i,s,l=0,m=n||[],b=!1,u={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,a){return c=t,i=0,s=e,u.n=a,o}};function p(a,r){for(i=a,s=r,t=0;!b&&l&&!n&&t<m.length;t++){var n,c=m[t],p=u.p,d=c[2];a>3?(n=d===r)&&(s=c[(i=c[4])?5:(i=3,3)],c[4]=c[5]=e):c[0]<=p&&((n=a<2&&p<c[1])?(i=0,u.v=r,u.n=c[1]):p<d&&(n=a<3||c[0]>r||r>d)&&(c[4]=a,c[5]=r,u.n=d,i=0))}if(n||a>1)return o;throw b=!0,r}return function(n,m,d){if(l>1)throw TypeError("Generator is already running");for(b&&1===m&&p(m,d),i=m,s=d;(t=i<2?e:s)||!b;){c||(i?i<3?(i>1&&(u.n=-1),p(i,s)):u.n=s:u.v=s);try{if(l=2,c){if(i||(n="next"),t=c[n]){if(!(t=t.call(c,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,i<2&&(i=0)}else 1===i&&(t=c.return)&&t.call(c),i<2&&(s=TypeError("The iterator does not provide a '"+n+"' method"),i=1);c=e}else if((t=(b=u.n<0)?s:a.call(r,u))!==o)break}catch(t){c=e,i=1,s=t}finally{l=1}}return{value:t,done:b}}}(a,n,c),!0),l}var o={};function i(){}function s(){}function l(){}t=Object.getPrototypeOf;var m=[][r]?t(t([][r]())):(N(t={},r,(function(){return this})),t),b=l.prototype=i.prototype=Object.create(m);function u(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,N(e,n,"GeneratorFunction")),e.prototype=Object.create(b),e}return s.prototype=l,N(b,"constructor",l),N(l,"constructor",s),s.displayName="GeneratorFunction",N(l,n,"GeneratorFunction"),N(b),N(b,n,"Generator"),N(b,r,(function(){return this})),N(b,"toString",(function(){return"[object Generator]"})),(_=function(){return{w:c,m:u}})()}function N(e,t,a,r){var n=Object.defineProperty;try{n({},"",{})}catch(e){n=0}(N=function(e,t,a,r){function c(t,a){N(e,t,(function(e){return this._invoke(t,a,e)}))}t?n?n(e,t,{value:a,enumerable:!r,configurable:!r,writable:!r}):e[t]=a:(c("next",0),c("throw",1),c("return",2))})(e,t,a,r)}function k(e,t,a,r,n,c,o){try{var i=e[c](o),s=i.value}catch(e){return void a(e)}i.done?t(s):Promise.resolve(s).then(r,n)}function S(e){return function(){var t=this,a=arguments;return new Promise((function(r,n){var c=e.apply(t,a);function o(e){k(c,r,n,o,i,"next",e)}function i(e){k(c,r,n,o,i,"throw",e)}o(void 0)}))}}function T(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var r,n,c,o,i=[],s=!0,l=!1;try{if(c=(a=a.call(e)).next,0===t){if(Object(a)!==a)return;s=!1}else for(;!(s=(r=c.call(a)).done)&&(i.push(r.value),i.length!==t);s=!0);}catch(e){l=!0,n=e}finally{try{if(!s&&null!=a.return&&(o=a.return(),Object(o)!==o))return}finally{if(l)throw n}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return C(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?C(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}t.default=function(e){var t=Object(r.useContext)(o.h),a=T(Object(r.useState)(!1),2),i=a[0],b=a[1],N=T(Object(r.useState)(1),2),k=N[0],C=N[1],P=T(Object(r.useState)(""),2),x=P[0],I=P[1],M=T(Object(r.useState)({loading:!1,error:!1,success:!1,message:""}),2),A=M[0],D=M[1],R=Object(r.useRef)(),Y=T(Object(r.useState)(!1),2),F=Y[0],H=Y[1],L=T(Object(r.useState)(!1),2),B=L[0],G=L[1],U=T(Object(r.useState)(!0),2),z=U[0],q=U[1],J=T(Object(r.useState)(!1),2),V=J[0],W=J[1],K=T(Object(r.useState)({}),2),Q=K[0],$=K[1],X=T(Object(r.useState)(!1),2),Z=X[0],ee=X[1],te=T(Object(r.useState)({message:"",type:1}),2),ae=te[0],re=te[1],ne=Object(m.a)().setCampaignValues,ce=Object(o.K)(),oe=l.a.getCampaignData(),ie=l.a.getCampaignId(),se=(l.a.getEditableMode(),parseInt(oe.type));Object(r.useEffect)((function(){!function(){if(oe.data&&oe.data.content&&oe.data.content.length>0){var e=!0;oe.data.content.map((function(t,a){oe.hasOwnProperty("validated_email_body_".concat(a))&&!oe["validated_email_body_".concat(a)]&&(e=!1)})),G(e)}}()}),[oe]),Object(r.useEffect)((function(){if(oe)if(oe.hasOwnProperty("execution_time")&&!Object(p.isNull)(oe.execution_time))C(2),I(u()(Object(o.lb)(oe.execution_time,!0,!0,!1)).format("YYYY-MM-DDTHH:mm:ss"));else{var e=Object(o.R)(u()(new Date)).format("YYYY-MM-DDTHH:mm:ss");I(e)}}),[]),Object(r.useEffect)((function(){document.addEventListener("click",(function(e){var t=document.getElementsByClassName("bwf-crm-campaign-schedule-popover")[0],a=!0;void 0!==t&&t.contains(e.target)&&(a=!1),i&&"bwf-crm-campaign-review-schedule-text-box"!=e.target.id&&a&&b(!1)}))}));var le=Object(v.a)().setL2Title;Object(r.useEffect)((function(){le("title"in oe?Object(r.createElement)(r.Fragment,null,oe.title):"")}),[oe]);var me=oe?oe.count:0,be=[{value:1,className:"bwf-crm-campaign-schedule bwf-crm-campaign-schedule-now",label:Object(c.__)("Broadcast Now","wp-marketing-automations")},{value:2,className:"bwf-crm-campaign-schedule bwf-crm-campaign-schedule-later",label:Object(c.__)("Schedule For Later","wp-marketing-automations")}],ue=function(){var a=S(_().m((function a(){var r,n,i;return _().w((function(a){for(;;)switch(a.p=a.n){case 0:if(e.setPending(!0),!(me<=0)){a.n=1;break}return D({status:!0,error:Object(c.__)("No Contacts are selected.","wp-marketing-automations")}),e.setPending(!1),a.a(2);case 1:if(r=Object(o.R)(u()(new Date)).format("YYYY-MM-DDTHH:mm:ss"),n=Object(o.R)(u()(x)),2!=k||n.isAfter(r)||n.isSame(r,"minute")){a.n=2;break}return D({status:!0,error:Object(c.__)("Given time should exceeds the current time.","wp-marketing-automations")}),e.setPending(!1),a.a(2);case 2:return a.p=2,a.n=3,s()({path:Object(o.C)("/broadcast/".concat(ie)),method:"POST",data:{data:{schedule_time:2==k?Object(o.W)(x).utc().format():"",modified_by:Object(o.Q)()},step:4},headers:{"Content-Type":"application/json"}}).then((function(e){200==e.code?(t(e.message),Object(o.Pb)(t,3e3),setTimeout((function(){ne("data",e.result),ne("editableMode",!1)}),2e3)):D({status:!0,error:e.message})}));case 3:a.n=5;break;case 4:a.p=4,i=a.v,D({status:!0,error:i.message});case 5:e.setPending(!1);case 6:return a.a(2)}}),a,null,[[2,4]])})));return function(){return a.apply(this,arguments)}}(),pe=function(){var e=S(_().m((function e(t){return _().w((function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,q(!0),e.n=1,s()({path:Object(o.C)("/broadcast/email-preview"),method:"POST",data:t}).then((function(e){W(e.result.body.replace(/\\/g,"")),q(!1)}));case 1:e.n=3;break;case 2:return e.p=2,e.v,e.a(2,Object(r.createElement)(r.Fragment,null));case 3:return e.a(2)}}),e,null,[[0,2]])})));return function(t){return e.apply(this,arguments)}}(),de=function(e){var t="",a=!1;return 3==se?e.hasOwnProperty("whatsAppImage")&&e.whatsAppImage&&e.hasOwnProperty("whatsAppImageSetting")&&e.whatsAppImageSetting.hasOwnProperty("position")&&!Object(p.isEmpty)(e.whatsAppImageSetting.position)&&e.whatsAppImageSetting.hasOwnProperty("imageURL")&&!Object(p.isEmpty)(e.whatsAppImageSetting.imageURL)&&(t="before"===e.whatsAppImageSetting.position?Object(r.createElement)(r.Fragment,null,Object(r.createElement)("img",{src:e.whatsAppImageSetting.imageURL,width:50,height:50}),Object(r.createElement)("div",{dangerouslySetInnerHTML:{__html:e.body}})):Object(r.createElement)(r.Fragment,null,Object(r.createElement)("div",{dangerouslySetInnerHTML:{__html:e.body}}),Object(r.createElement)("img",{src:e.whatsAppImageSetting.imageURL,width:50,height:50})),a=!1):2==se&&(a=!0),a?(t=Object(r.createElement)("div",{dangerouslySetInnerHTML:{__html:"editor"===e.type?e.editor.body:e.body}}),W(t),q(!1)):pe({content:"editor"===e.type?e.editor.body:e.body,type:e.type}),e.mode=oe.type,e};return Object(r.createElement)(r.Fragment,null,Object(r.createElement)(w.a,null),Object(r.createElement)("div",{className:"bwf-campaign-step-div bwf-card-wrap bwf-campaign-step-4"},Object(r.createElement)("div",{className:"bwf-card-header"},Object(r.createElement)("span",{className:"bwf-form-title"},Object(c.__)("Review & Schedule","wp-marketing-automations"))),Object(r.createElement)("div",{className:""},Object(r.createElement)("div",{className:"bwf-p-gap bwf-top-gap"},Object(r.createElement)("div",{className:"bwf-crm-overview-detail-wrap"},Object(r.createElement)("div",{className:"bwf-crm-overview-report-header bwf-heading3-new"},Object(c.__)("Information","wp-marketing-automations")),Object(r.createElement)(n.CardBody,{className:"bwf-crm-overview-report-body"},Object(r.createElement)("div",{className:"bwf-report-row",key:1},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Title","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},oe.title)),Object(r.createElement)("div",{className:"bwf-report-row",key:2},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Type","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},ce[se].label)),!!oe.description&&Object(r.createElement)("div",{className:"bwf-report-row",key:3},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Description","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},oe.description)))))),Object(r.createElement)("div",{className:"bwf-pt-0"},Object(r.createElement)("div",{className:"bwf-p-gap "},Object(r.createElement)(r.Fragment,null,Object(r.createElement)("div",{className:"bwf-crm-overview-detail-wrap"},Object(r.createElement)("div",{className:"bwf-crm-overview-report-header bwf-heading3-new"},Object(c.__)("Contacts","wp-marketing-automations")),Object(r.createElement)(n.CardBody,{className:"bwf-crm-overview-report-body"},Object(r.createElement)("div",{className:"bwf-report-row",key:1},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Total","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},Object(r.createElement)("b",null,me))),oe.data.hasOwnProperty("filters")&&!Object(p.isEmpty)(oe.data.filters)&&Object(r.createElement)("div",{className:"bwf-report-row",key:2},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Segments","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},Object(d.b)(oe.data.filters)))))))),Object(r.createElement)("div",{className:" bwf-pt-0"},Object(r.createElement)("div",{className:"bwf-p-gap "},Object(r.createElement)("div",{className:"bwf-crm-overview-detail-wrap"},Object(r.createElement)("div",{className:"bwf-crm-overview-report-header bwf-heading3-new"},Object(c.__)("Content","wp-marketing-automations")),Object(r.createElement)(n.CardBody,{className:"bwf-crm-overview-report-body"},se&&1==se&&oe.data.hasOwnProperty("senders_name")&&!Object(p.isEmpty)(oe.data.senders_name)&&Object(r.createElement)("div",{className:"bwf-report-row",key:1},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("From Name","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},oe.data.senders_name)),se&&1==se&&oe.data.hasOwnProperty("senders_email")&&!Object(p.isEmpty)(oe.data.senders_email)&&Object(r.createElement)("div",{className:"bwf-report-row",key:2},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("From Email","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},oe.data.senders_email)),se&&1==se&&oe.data.hasOwnProperty("replyto")&&!Object(p.isEmpty)(oe.data.replyto)&&Object(r.createElement)("div",{className:"bwf-report-row",key:3},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Reply-To Email","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},oe.data.replyto)),oe.data&&oe.data.content&&oe.data.content.map((function(e,t){return Object(r.createElement)("div",{className:"bwf-report-row",key:t},Object(r.createElement)("div",{className:"bwf-report-row-label"},oe.data.content.length>1?Object(c.__)("Content #","wp-marketing-automations")+(parseInt(t)+1):Object(c.__)("Content","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value bwf-report-value-modal"},se&&e.subject&&Object(r.createElement)("span",null,e.subject),Object(r.createElement)(y.a,{isTertiary:!0,className:"bwf-btn-small is-light",onClick:S(_().m((function t(){var a;return _().w((function(t){for(;;)switch(t.n){case 0:return H(!0),t.n=1,de(e);case 1:a=t.v,$(a);case 2:return t.a(2)}}),t)})))},Object(c.__)("View details","wp-marketing-automations")),oe.hasOwnProperty("validated_email_body_".concat(t))&&!oe["validated_email_body_".concat(t)]&&Object(r.createElement)("div",{className:"bwf-error"},Object(c.__)("Something is wrong with the HTML of email body. Please review the HTML for any syntax errors.","wp-marketing-automations"))))})),!!oe.data&&oe.data.hasOwnProperty("smart_send")&&oe.data.smart_send.hasOwnProperty("enable")&&oe.data.smart_send.enable&&Object(r.createElement)(r.Fragment,null,Object(r.createElement)("div",{className:"bwf-report-row",key:11},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Smart sending","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},Object(c.__)("Enabled","wp-marketing-automations"))),Object(r.createElement)("div",{className:"bwf-report-row",key:12},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Sample size (in percent)","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},oe.data.smart_send.percent+" %")),Object(r.createElement)("div",{className:"bwf-report-row",key:13},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Wait Time (in hours)","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},oe.data.smart_send.hours+" "+Object(c.__)("hours","wp-marketing-automations")))))))),Object(r.createElement)("div",{className:"bwf-pt-0"},Object(r.createElement)("div",{className:"bwf-p-gap "},Object(r.createElement)("div",{className:"bwf-crm-overview-detail-wrap"},Object(r.createElement)("div",{className:"bwf-crm-overview-report-header bwf-heading3-new"},Object(c.__)("Schedule","wp-marketing-automations")),Object(r.createElement)(n.CardBody,{className:"bwf-crm-overview-schedule-section"},Object(r.createElement)("div",{className:"bwf-campaign-review-broadcast-wrap",onClick:function(){b(!1)}},Object(r.createElement)("div",{className:"bwf-display-flex gap--8 bwf-flex-start"},be.map((function(e,t){return Object(r.createElement)(y.a,{onClick:function(){C(e.value)},isSecondary:e.value===k,isTertiary:e.value!==k,className:"bwf-btn-small "+(e.value===k?"is-border is-blue-bg":""),key:t},1==e.value?Object(r.createElement)("span",{className:"bwf-rotate-90 bwf-pt-8"},Object(r.createElement)(O.a,{icon:"broadcasts",size:16,color:e.value===k?"#fff":"#000"})):Object(r.createElement)(O.a,{icon:"timer",size:16,color:e.value===k?"#fff":"#000"}),e.label)}))),2==k&&Object(r.createElement)("div",{className:"bwf-crm-campaign-review-date-wrap"},Object(r.createElement)("div",{className:"bwf-display-flex bwf-flex-start"},Object(r.createElement)(O.a,{icon:"calender"}),Object(r.createElement)("span",null,Object(c.__)("Pick Date and Time","wp-marketing-automations"))),Object(r.createElement)("div",{className:"bwf-crm-campaign-review-schedule-text-box",id:"bwf-crm-campaign-review-schedule-text-box",onClick:function(e){e.stopPropagation(),b(!i)}},Object(o.lb)(u()(x),!1,!1),i&&Object(r.createElement)(h.a,{ref:R,position:"top",shift:!0,focusOnMount:!0,onFocusOutside:function(e){b(!1)}},Object(r.createElement)("div",{className:"bwf-crm-campaign-schedule-popover",onClick:function(e){return e.stopPropagation()}},Object(r.createElement)(n.DateTimePicker,{currentDate:x,isInvalidDate:function(e){return Object(o.R)(e).isBefore(Object(o.R)(u()()),"day")},onChange:function(e,t){var a=Object(o.R)(u()(new Date)).format("YYYY-MM-DDTHH:mm:ss"),r=Object(o.R)(u()(e));r.isAfter(a)||r.isSame(a,"minute")?I(e):re({message:Object(c.__)("Given time should exceeds the current time.","wp-marketing-automations"),type:0})},is12Hour:!0}),Object(r.createElement)("div",{className:"bwf-p-0 bwf-m-0 bwf-display-flex bwf-mt-16"},Object(r.createElement)("span",null,Object(c.__)("Current Store Time","wp-marketing-automations")+":","Â "),Object(o.lb)(u()().tz("UTC")))))))))))),Object(r.createElement)("div",{className:"bwf-p-gap bwf-pt-0"},Object(r.createElement)("div",{className:"bwf-crm-campaign-navigation"},Object(r.createElement)(y.a,{isSecondary:!0,className:"bwf-crm-navigation-previous",onClick:function(){ne("step",3)}},Object(c.__)("Previous","wp-marketing-automations")),Object(r.createElement)(y.a,{className:"bwf-crm-navigation-next",isPrimary:!0,disabled:!B,onClick:function(){Object(o.fc)()?ue():ee(!0)},isBusy:e.isPending},!Object(o.fc)()&&Object(r.createElement)(O.a,{icon:"king",color:"#fff",size:16}),1===k?Object(c.__)("Send Now","wp-marketing-automations"):Object(c.__)("Schedule","wp-marketing-automations")))),Object(r.createElement)(g.a,{isOpen:F,isLoading:z,onRequestClose:function(){return H(!1)},subject:Q.subject,preHeader:Q.preheader,body:V,type:Q.type,sourceType:2,mode:oe.type,utm:Q.utm}),Object(r.createElement)(j.a,{modalTitle:Object(c.__)("Update Broadcast","wp-marketing-automations"),confirmText:A.confirmText,deleteEntityName:A.deleteEntityName,confirmButtonText:A.buttonConfirm,cancelButtonText:A.buttonCancel,onConfirm:A.onConfirm,isLoading:A.loading,successMessage:A.success,errorMessage:A.error,onRequestClose:function(){return D({status:!1})},isOpen:A.status,isDelete:!0}),Object(r.createElement)(f.a,{message:ae.message,type:ae.type,removeMessage:function(){return re({message:"",type:1})}})),!Object(o.fc)()&&Object(r.createElement)(E.b,{isOpen:Z,onRequestClose:function(){return ee(!1)},modalContent:{isFeature:!0,featureTitle:Object(c.__)("Broadcast","wp-marketing-automations")}}))}}}]);